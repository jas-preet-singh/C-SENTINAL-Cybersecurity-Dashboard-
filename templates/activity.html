{% extends "base.html" %}

{% block title %}Activity History - CyberSec Dashboard{% endblock %}

{% block content %}
<div class="container">
    <!-- Header Section -->
    <div class="row mt-4 mb-5">
        <div class="col-12">
            <div class="welcome-card">
                <h2>
                    <i class="fas fa-history"></i> 
                    Activity History
                </h2>
                <p>Track your security operations and scan results.</p>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card activity-card">
                <div class="card-header">
                    <h6><i class="fas fa-clock"></i> Recent Jobs</h6>
                </div>
                <div class="card-body">
                    {% if recent_jobs %}
                        <div class="activity-list">
                            {% for job in recent_jobs %}
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-{{ 'check' if job.status == 'completed' else 'clock' if job.status == 'running' else 'times' }}"></i>
                                </div>
                                <div class="activity-details">
                                    <strong>{{ job.job_type.replace('_', ' ').title() }}</strong>
                                    <small class="d-block text-muted">{{ job.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                                    <span class="badge bg-{{ 'success' if job.status == 'completed' else 'warning' if job.status == 'running' else 'danger' }}">
                                        {{ job.status.title() }}
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted text-center">No recent jobs</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card activity-card">
                <div class="card-header">
                    <h6><i class="fas fa-shield-alt"></i> Recent Scans</h6>
                </div>
                <div class="card-body">
                    {% if recent_scans %}
                        <div class="activity-list">
                            {% for scan in recent_scans %}
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-{{ 'shield-alt' if scan.risk_level == 'low' else 'exclamation-triangle' if scan.risk_level == 'medium' else 'skull-crossbones' }}"></i>
                                </div>
                                <div class="activity-details">
                                    <strong>{{ scan.scan_type.title() }} Scan</strong>
                                    <small class="d-block text-muted">{{ scan.target[:50] }}{% if scan.target|length > 50 %}...{% endif %}</small>
                                    <span class="badge bg-{{ 'success' if scan.risk_level == 'low' else 'warning' if scan.risk_level == 'medium' else 'danger' }}">
                                        {{ scan.risk_level.title() }} Risk
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted text-center">No recent scans</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Activity Statistics -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card analytics-card">
                <div class="card-header">
                    <h6><i class="fas fa-chart-line"></i> Activity Summary</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="stat-item">
                                <h3 class="stat-number">{{ total_jobs or 0 }}</h3>
                                <small class="text-muted">Total Jobs</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <h3 class="stat-number text-success">{{ completed_jobs or 0 }}</h3>
                                <small class="text-muted">Completed</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <h3 class="stat-number">{{ total_scans or 0 }}</h3>
                                <small class="text-muted">Total Scans</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-item">
                                <h3 class="stat-number text-warning">{{ running_jobs or 0 }}</h3>
                                <small class="text-muted">Active Jobs</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}