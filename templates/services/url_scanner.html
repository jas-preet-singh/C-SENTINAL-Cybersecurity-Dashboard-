{% extends "base.html" %}

{% block title %}URL & Malware Scanner - CyberSec Dashboard{% endblock %}

{% block content %}
<style>
/* Footer collision prevention - aggressive spacing */
.main-content {
    padding-bottom: 10rem !important;
}
.educational-section {
    margin-bottom: 4rem !important;
}
</style>

<div class="container-fluid">
 <div class="row">
 <div class="col-12">
 <div class="d-flex justify-content-between align-items-center mb-3">
 <h2><i class="fas fa-globe"></i> URL & Malware Scanner</h2>
 <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
 <i class="fas fa-home"></i> Back to Home
 </a>
 </div>

 <div class="row">
 <!-- URL Scanner -->
 <div class="col-md-6">
 <div class="card module-card mb-3">
 <div class="card-header">
 <h5><i class="fas fa-link"></i> URL Safety Scanner</h5>
 </div>
 <div class="card-body">
 <form id="urlScanForm">
 <div class="mb-3">
 <label class="form-label">Enter URL to Scan</label>
 <input type="url" name="url" class="form-control" placeholder="https://example.com" required>
 <small class="form-text text-muted">Include http:// or https://</small>
 </div>

 <button type="submit" class="btn btn-primary btn-glow">
 <i class="fas fa-search"></i> Scan URL
 </button>
 </form>

 <!-- URL Scan Results Container -->
 <div id="urlResults" class="results-container mt-3" style="display: none;"></div>

 <div class="mt-3">
 <h6>URL Scanner checks for:</h6>
 <ul class="list-unstyled">
 <li><i class="fas fa-check text-success"></i> Suspicious patterns</li>
 <li><i class="fas fa-check text-success"></i> Known malicious domains</li>
 <li><i class="fas fa-check text-success"></i> Phishing indicators</li>
 <li><i class="fas fa-check text-success"></i> Connection safety</li>
 </ul>
 </div>
 </div>
 </div>
 </div>

 <!-- File Scanner -->
 <div class="col-md-6">
 <div class="card module-card mb-3">
 <div class="card-header">
 <h5><i class="fas fa-shield-virus"></i> File Malware Scanner</h5>
 </div>
 <div class="card-body">
 <form id="fileScanForm" enctype="multipart/form-data">
 <div class="mb-3">
 <label class="form-label">Select File to Scan</label>
 <input type="file" name="file" class="form-control" required>
 <small class="form-text text-muted">Max file size: 50MB</small>
 </div>

 <button type="submit" class="btn btn-warning btn-glow">
 <i class="fas fa-shield-alt"></i> Scan File
 </button>
 </form>

 <!-- File Scan Results Container -->
 <div id="fileResults" class="results-container mt-3" style="display: none;"></div>

 <div class="mt-3">
 <h6>File Scanner analyzes:</h6>
 <ul class="list-unstyled">
 <li><i class="fas fa-check text-success"></i> File signatures</li>
 <li><i class="fas fa-check text-success"></i> Suspicious patterns</li>
 <li><i class="fas fa-check text-success"></i> File metadata</li>
 <li><i class="fas fa-check text-success"></i> Known malware hashes</li>
 </ul>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Security Tips -->
 <div class="card module-card">
 <div class="card-body">
 <h5><i class="fas fa-shield-alt"></i> Security Best Practices</h5>
 <div class="row">
 <div class="col-md-4">
 <div class="text-center p-3">
 <i class="fas fa-exclamation-triangle fa-2x text-warning mb-2"></i>
 <h6>Think Before You Click</h6>
 <ul class="small text-start">
 <li>Verify sender identity</li>
 <li>Check URL carefully</li>
 <li>Look for typos/misspellings</li>
 <li>Be wary of urgent requests</li>
 </ul>
 </div>
 </div>
 <div class="col-md-4">
 <div class="text-center p-3">
 <i class="fas fa-download fa-2x text-info mb-2"></i>
 <h6>Safe Downloads</h6>
 <ul class="small text-start">
 <li>Download from official sources</li>
 <li>Verify file checksums</li>
 <li>Scan files before opening</li>
 <li>Keep antivirus updated</li>
 </ul>
 </div>
 </div>
 <div class="col-md-4">
 <div class="text-center p-3">
 <i class="fas fa-user-shield fa-2x text-success mb-2"></i>
 <h6>Personal Protection</h6>
 <ul class="small text-start">
 <li>Use updated browsers</li>
 <li>Enable security features</li>
 <li>Don't enter credentials on suspicious sites</li>
 <li>Report phishing attempts</li>
 </ul>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Warning -->
 <div class="alert alert-warning mt-3">
 <i class="fas fa-exclamation-triangle"></i>
 <strong>Disclaimer:</strong> These scanners provide basic security analysis.
 For comprehensive security, use multiple tools and professional antivirus solutions.
 Always exercise caution when dealing with suspicious files or URLs.
 </div>
 </div>
 </div>
</div>

<style>
.results-container {
    padding: 15px;
    border: 1px solid #00ff66;
    border-radius: 5px;
    background: rgba(0, 255, 102, 0.05);
}

.success-result {
    color: #00ff66;
    border: 1px solid #00ff66;
    background: rgba(0, 255, 102, 0.1);
    padding: 15px;
    border-radius: 5px;
}

.error-result {
    color: #ffc107;
    border: 1px solid #ffc107;
    background: rgba(255, 193, 7, 0.1);
    padding: 15px;
    border-radius: 5px;
}

.warning-result {
    color: #ff6b6b;
    border: 1px solid #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
    padding: 15px;
    border-radius: 5px;
}

.result-item {
    margin-top: 10px;
}

.risk-level {
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 0.8rem;
    font-weight: bold;
}

.risk-low { background-color: #28a745; color: white; }
.risk-medium { background-color: #ffc107; color: #212529; }
.risk-high { background-color: #dc3545; color: white; }
.risk-unknown { background-color: #6c757d; color: white; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle URL Scan Form Submission
    document.getElementById('urlScanForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const button = this.querySelector('button[type="submit"]');
        const resultsDiv = document.getElementById('urlResults');
        
        // Disable button and show loading
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Scanning...';
        
        fetch('/scan/url', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Determine status based on risk level for more precise messaging
                let resultClass, icon, statusText;
                
                if (data.risk_level === 'high') {
                    resultClass = 'warning-result';
                    icon = 'fas fa-times-circle';
                    statusText = 'URL APPEARS UNSAFE - HIGH RISK';
                } else if (data.risk_level === 'medium') {
                    resultClass = 'warning-result';
                    icon = 'fas fa-exclamation-triangle';
                    statusText = 'CAUTION REQUIRED - MEDIUM RISK';
                } else if (data.risk_level === 'low') {
                    resultClass = 'success-result';
                    icon = 'fas fa-check-circle';
                    statusText = 'URL APPEARS SAFE - LOW RISK';
                } else {
                    resultClass = 'error-result';
                    icon = 'fas fa-question-circle';
                    statusText = 'UNKNOWN RISK LEVEL';
                }
                
                const reasonsList = data.reasons && data.reasons.length > 0 ? 
                    `<div class="mt-3">
                        <h6><i class="fas fa-info-circle me-2"></i>Risk Assessment Details:</h6>
                        <ul class="small">
                            ${data.reasons.map(reason => `<li>${reason}</li>`).join('')}
                        </ul>
                    </div>` : '';
                    
                resultsDiv.innerHTML = `
                    <div class="${resultClass}">
                        <h6><i class="${icon} me-2"></i>${statusText}</h6>
                        <div class="result-item">
                            <p class="mb-2"><strong>URL:</strong> ${data.url}</p>
                            <p class="mb-2"><strong>Assessment:</strong> ${data.message}</p>
                            <p class="mb-2">
                                <strong>Risk Level:</strong> 
                                <span class="risk-level risk-${data.risk_level}">${data.risk_level.toUpperCase()}</span>
                            </p>
                            ${reasonsList}
                        </div>
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div class="error-result">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Scan Failed</h6>
                        <p>${data.error}</p>
                    </div>
                `;
            }
            resultsDiv.style.display = 'block';
        })
        .catch(error => {
            resultsDiv.innerHTML = `
                <div class="error-result">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Error</h6>
                    <p>An unexpected error occurred: ${error.message}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';
        })
        .finally(() => {
            // Re-enable button
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-search me-2"></i>Scan URL';
        });
    });

    // Handle File Scan Form Submission
    document.getElementById('fileScanForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const button = this.querySelector('button[type="submit"]');
        const resultsDiv = document.getElementById('fileResults');
        
        // Disable button and show loading
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Scanning...';
        
        fetch('/scan/file', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Determine status based on risk level for more precise messaging
                let resultClass, icon, statusText;
                
                if (data.risk_level === 'high') {
                    resultClass = 'warning-result';
                    icon = 'fas fa-times-circle';
                    statusText = 'FILE APPEARS UNSAFE - HIGH RISK';
                } else if (data.risk_level === 'medium') {
                    resultClass = 'warning-result';
                    icon = 'fas fa-exclamation-triangle';
                    statusText = 'CAUTION REQUIRED - MEDIUM RISK';
                } else if (data.risk_level === 'low') {
                    resultClass = 'success-result';
                    icon = 'fas fa-check-circle';
                    statusText = 'FILE APPEARS CLEAN - LOW RISK';
                } else {
                    resultClass = 'error-result';
                    icon = 'fas fa-question-circle';
                    statusText = 'UNKNOWN RISK LEVEL';
                }
                
                const reasonsList = data.reasons && data.reasons.length > 0 ? 
                    `<div class="mt-3">
                        <h6><i class="fas fa-info-circle me-2"></i>Risk Assessment Details:</h6>
                        <ul class="small">
                            ${data.reasons.map(reason => `<li>${reason}</li>`).join('')}
                        </ul>
                    </div>` : '';
                    
                resultsDiv.innerHTML = `
                    <div class="${resultClass}">
                        <h6><i class="${icon} me-2"></i>${statusText}</h6>
                        <div class="result-item">
                            <p class="mb-2"><strong>File:</strong> ${data.filename}</p>
                            <p class="mb-2"><strong>Assessment:</strong> ${data.message}</p>
                            <p class="mb-2">
                                <strong>Risk Level:</strong> 
                                <span class="risk-level risk-${data.risk_level}">${data.risk_level.toUpperCase()}</span>
                            </p>
                            ${reasonsList}
                        </div>
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div class="error-result">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Scan Failed</h6>
                        <p>${data.error}</p>
                    </div>
                `;
            }
            resultsDiv.style.display = 'block';
        })
        .catch(error => {
            resultsDiv.innerHTML = `
                <div class="error-result">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Error</h6>
                    <p>An unexpected error occurred: ${error.message}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';
        })
        .finally(() => {
            // Re-enable button
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-shield-alt me-2"></i>Scan File';
        });
    });
});
</script>
{% endblock %}