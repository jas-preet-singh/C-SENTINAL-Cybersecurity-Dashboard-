{% extends "base.html" %}

{% block title %}Steganography Tool - CyberSec Dashboard{% endblock %}

{% block content %}
<style>
/* Steganography-specific styling */
.steganography-tools .tab-content {
    min-height: auto !important;
}
.steganography-tools .results-container {
    max-height: 500px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid #00ff66;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
}
.steganography-tools .success-result {
    color: #00ff66 !important;
    border-left: 3px solid #00ff66;
    padding-left: 10px;
}
.steganography-tools .error-result {
    color: #ff4444 !important;
    border-left: 3px solid #ff4444;
    padding-left: 10px;
}
.steganography-tools .warning-result {
    color: #ffa500 !important;
    border-left: 3px solid #ffa500;
    padding-left: 10px;
}
.steganography-tools .result-item {
    background: rgba(0, 255, 102, 0.1);
    border: 1px solid rgba(0, 255, 102, 0.3);
    border-radius: 5px;
    padding: 10px;
    margin: 8px 0;
}
.steganography-tools .tab-pane {
    padding-top: 1rem;
    padding-bottom: 1rem;
}
.steganography-tools .input-group {
    margin-bottom: 1rem;
}
.steganography-form-section {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(0, 255, 102, 0.3);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}
.steganography-features {
    background: rgba(0, 0, 0, 0.2);
    border-left: 3px solid #00ff66;
    padding: 15px;
    margin-top: 20px;
}
</style>

<div class="container-fluid steganography-tools">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-eye-slash"></i> STEGANOGRAPHY TOOL</h2>
                <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                    <i class="fas fa-home"></i> Back to Home
                </a>
            </div>
            <p class="text-muted mb-4">Hide and extract secret messages in ANY file type using advanced steganography techniques</p>

            <!-- Steganography Tools Tabs -->
            <div class="card module-card">
                <div class="card-body py-3">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" id="steganographyToolsTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="encode-tab" data-bs-toggle="tab" data-bs-target="#encode" type="button" role="tab">
                                <i class="fas fa-lock"></i> HIDE TEXT IN FILE
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="decode-tab" data-bs-toggle="tab" data-bs-target="#decode" type="button" role="tab">
                                <i class="fas fa-unlock"></i> EXTRACT HIDDEN TEXT
                            </button>
                        </li>
                    </ul>

                    <!-- Tab content -->
                    <div class="tab-content" id="steganographyToolsTabContent">
                        <!-- Hide Text Tab -->
                        <div class="tab-pane fade show active" id="encode" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="steganography-form-section">
                                        <h5><i class="fas fa-file"></i> HIDE SECRET TEXT</h5>
                                        <form id="encodeForm" enctype="multipart/form-data">
                                            <div class="input-group mb-3">
                                                <span class="input-group-text bg-dark text-success border-success">
                                                    <i class="fas fa-file"></i>
                                                </span>
                                                <input type="file" class="form-control bg-dark text-light border-success" id="coverImage" name="cover_image" accept="*/*" required>
                                            </div>
                                            <div class="form-text text-muted mb-3">Supported: All file types (PDF, DOCX, PNG, MP4, WAVE, etc.)</div>
                                            
                                            <div class="mb-3">
                                                <label class="form-label text-light">
                                                    <i class="fas fa-key me-2"></i>Secret Message
                                                </label>
                                                <textarea class="form-control bg-dark text-light border-success" id="secretText" name="secret_text" rows="4" placeholder="Enter your secret message here..." required></textarea>
                                                <div class="form-text text-muted mt-2">
                                                    <span id="textCounter">0</span> characters
                                                    <span id="capacityInfo" class="ms-2"></span>
                                                </div>
                                            </div>
                                            
                                            <button type="submit" class="btn btn-warning w-100">
                                                <i class="fas fa-eye-slash me-2"></i>Hide Text in File
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="steganography-features">
                                        <h6><i class="fas fa-info-circle"></i> STEGANOGRAPHY FEATURES</h6>
                                        <ul class="text-success list-unstyled mt-3">
                                            <li><i class="fas fa-check-circle me-2"></i> Universal file steganography</li>
                                            <li><i class="fas fa-check-circle me-2"></i> All file format support</li>
                                            <li><i class="fas fa-check-circle me-2"></i> Invisible text embedding</li>
                                            <li><i class="fas fa-check-circle me-2"></i> Capacity calculation tools</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="results-container" id="encodeResult">
                                        <i class="fas fa-arrow-left me-2"></i>
                                        Upload any file and enter text to begin
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Extract Text Tab -->
                        <div class="tab-pane fade" id="decode" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="steganography-form-section">
                                        <h5><i class="fas fa-search"></i> EXTRACT HIDDEN TEXT</h5>
                                        <form id="decodeForm" enctype="multipart/form-data">
                                            <div class="input-group mb-3">
                                                <span class="input-group-text bg-dark text-success border-success">
                                                    <i class="fas fa-file"></i>
                                                </span>
                                                <input type="file" class="form-control bg-dark text-light border-success" id="stegoImage" name="stego_image" accept="*/*" required>
                                            </div>
                                            <div class="form-text text-muted mb-3">Upload any file that may contain hidden text</div>
                                            
                                            <button type="submit" class="btn btn-warning w-100">
                                                <i class="fas fa-unlock me-2"></i>Extract Hidden Text
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="steganography-features">
                                        <h6><i class="fas fa-info-circle"></i> EXTRACTION FEATURES</h6>
                                        <ul class="text-success list-unstyled mt-3">
                                            <li><i class="fas fa-check-circle me-2"></i> Automatic message detection</li>
                                            <li><i class="fas fa-check-circle me-2"></i> Text recovery algorithms</li>
                                            <li><i class="fas fa-check-circle me-2"></i> Digital forensics techniques</li>
                                            <li><i class="fas fa-check-circle me-2"></i> Educational demonstrations</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="results-container" id="decodeResult">
                                        <i class="fas fa-arrow-left me-2"></i>
                                        Upload a file with hidden text to extract it
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Educational Information Section -->
            <div class="row mt-4 mb-5">
                <div class="col-12">
                    <div class="card module-card">
                        <div class="card-body">
                            <h5><i class="fas fa-graduation-cap"></i> EDUCATIONAL INFORMATION</h5>
                            <div class="row mt-3">
                                <div class="col-md-4">
                                    <div class="steganography-features">
                                        <h6 class="text-warning">HOW IT WORKS</h6>
                                        <p class="text-light small">
                                            Uses LSB (Least Significant Bit) technique to modify the least important bits of image pixels to hide text data.
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="steganography-features">
                                        <h6 class="text-warning">SECURITY IMPLICATIONS</h6>
                                        <p class="text-light small">
                                            Demonstrates how attackers can hide malicious payloads or exfiltrate data using innocent-looking images.
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="steganography-features">
                                        <h6 class="text-warning">DETECTION METHODS</h6>
                                        <p class="text-light small">
                                            Digital forensics tools can detect steganography through statistical analysis and file size anomalies.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Character counter for secret text
document.getElementById('secretText').addEventListener('input', function() {
    const text = this.value;
    const counter = document.getElementById('textCounter');
    counter.textContent = text.length;
});

// Image capacity checker
document.getElementById('coverImage').addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
        checkImageCapacity(file);
    }
});

function checkImageCapacity(file) {
    const formData = new FormData();
    formData.append('image', file);
    
    fetch('/steganography/capacity', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const capacityInfo = document.getElementById('capacityInfo');
            capacityInfo.innerHTML = `<span class="text-success">(Max capacity: ~${data.capacity} characters)</span>`;
        }
    })
    .catch(error => {
        console.error('Error checking capacity:', error);
    });
}

// Handle encoding form submission
document.getElementById('encodeForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const resultDiv = document.getElementById('encodeResult');
    
    // Show loading
    resultDiv.innerHTML = `
        <div class="text-center">
            <div class="spinner-border text-success" role="status">
                <span class="visually-hidden">Processing...</span>
            </div>
            <p class="text-light mt-2">Hiding text in image...</p>
        </div>
    `;
    
    fetch('/steganography/encode', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = `
                <div class="result-item success-result">
                    <h6><i class="fas fa-check-circle me-2"></i>Text Successfully Hidden!</h6>
                    <p class="mb-2">${data.message}</p>
                    <a href="${data.download_url}" class="btn btn-success btn-sm w-100 mt-2" download>
                        <i class="fas fa-download me-2"></i>Download Stego Image
                    </a>
                </div>
                <div class="result-item mt-3">
                    <h6 class="text-success">Statistics:</h6>
                    <ul class="list-unstyled text-light small">
                        <li><i class="fas fa-info-circle me-2"></i>Original size: ${data.original_size}</li>
                        <li><i class="fas fa-info-circle me-2"></i>Text length: ${data.text_length} characters</li>
                        <li><i class="fas fa-info-circle me-2"></i>Capacity used: ${data.capacity_used}%</li>
                    </ul>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="result-item error-result">
                    <i class="fas fa-exclamation-triangle me-2"></i>${data.error}
                </div>
            `;
        }
    })
    .catch(error => {
        resultDiv.innerHTML = `
            <div class="result-item error-result">
                <i class="fas fa-times-circle me-2"></i>Error: ${error.message}
            </div>
        `;
    });
});

// Handle decoding form submission
document.getElementById('decodeForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const resultDiv = document.getElementById('decodeResult');
    
    // Show loading
    resultDiv.innerHTML = `
        <div class="text-center">
            <div class="spinner-border text-success" role="status">
                <span class="visually-hidden">Processing...</span>
            </div>
            <p class="text-light mt-2">Extracting hidden text...</p>
        </div>
    `;
    
    fetch('/steganography/decode', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = `
                <div class="result-item success-result">
                    <h6><i class="fas fa-unlock me-2"></i>Hidden Text Found!</h6>
                </div>
                <div class="result-item mt-3">
                    <h6 class="text-success">Extracted Message:</h6>
                    <pre class="text-light bg-black p-3 rounded border mt-2" style="white-space: pre-wrap; word-wrap: break-word;">${data.hidden_text}</pre>
                    <p class="text-light small mt-2">
                        <i class="fas fa-info-circle me-2"></i>Message length: ${data.text_length} characters
                    </p>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="result-item warning-result">
                    <i class="fas fa-search me-2"></i>${data.error}
                </div>
            `;
        }
    })
    .catch(error => {
        resultDiv.innerHTML = `
            <div class="result-item error-result">
                <i class="fas fa-times-circle me-2"></i>Error: ${error.message}
            </div>
        `;
    });
});
</script>
{% endblock %}