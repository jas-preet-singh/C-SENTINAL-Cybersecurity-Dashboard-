{% extends "base.html" %}

{% block title %}Password Analyzer - CyberSec Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
 <div class="row">
 <div class="col-12">
 <div class="d-flex justify-content-between align-items-center mb-4">
 <h2><i class="fas fa-key"></i> Password Strength Analyzer</h2>
 <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
 <i class="fas fa-home"></i> Back to Home
 </a>
 </div>

 <div class="row">
 <!-- Password Input -->
 <div class="col-md-6">
 <div class="card module-card">
 <div class="card-body">
 <form id="passwordAnalysisForm">
 <div class="mb-3">
 <label class="form-label">Enter Password to Analyze</label>
 <div class="input-group">
 <input type="password" name="password" id="passwordInput" class="form-control" placeholder="Enter password..." required>
 <button type="button" class="btn btn-outline-secondary" id="togglePassword">
 <i class="fas fa-eye" id="eyeIcon"></i>
 </button>
 </div>
 </div>

 <button type="submit" class="btn btn-primary btn-glow">
 <i class="fas fa-search"></i> Analyze Password
 </button>
 </form>

 <!-- Password Strength Indicator -->
 <div id="strengthIndicator" class="mt-3" style="display: none;">
 <div class="d-flex justify-content-between align-items-center mb-2">
 <span>Strength:</span>
 <span id="strengthText" class="fw-bold">-</span>
 </div>
 <div class="progress">
 <div id="strengthBar" class="progress-bar" style="width: 0%"></div>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Analysis Results -->
 <div class="col-md-6">
 <div class="card module-card">
 <div class="card-body">
 <h5><i class="fas fa-chart-line"></i> Analysis Results</h5>
 <div id="analysisResults" style="display: none;">
 <div class="row mb-3">
 <div class="col-6">
 <strong>Score:</strong> <span id="scoreValue">-</span>/100
 </div>
 <div class="col-6">
 <strong>Entropy:</strong> <span id="entropyValue">-</span>
 </div>
 </div>

 <h6>Password Details:</h6>
 <ul id="detailsList" class="list-unstyled">
 <!-- Analysis details will be populated here -->
 </ul>

 <h6>Estimated Crack Time:</h6>
 <p id="crackTime" class="text-info">-</p>
 </div>
 </div>
 </div>
 </div>
 </div>

 <div class="row mt-4">
 <!-- Feedback -->
 <div class="col-md-6">
 <div class="card module-card">
 <div class="card-body">
 <h5><i class="fas fa-exclamation-circle"></i> Feedback</h5>
 <ul id="feedbackList" class="list-unstyled">
 <!-- Feedback will be populated here -->
 </ul>
 </div>
 </div>
 </div>

 <!-- Suggestions -->
 <div class="col-md-6">
 <div class="card module-card">
 <div class="card-body">
 <h5><i class="fas fa-lightbulb"></i> Strong Password Suggestions</h5>
 <ul id="suggestionsList" class="list-unstyled">
 <!-- Suggestions will be populated here -->
 </ul>
 </div>
 </div>
 </div>
 </div>

 <!-- Tips -->
 <div class="card module-card mt-4">
 <div class="card-body">
 <h5><i class="fas fa-info-circle"></i> Password Security Tips</h5>
 <div class="row">
 <div class="col-md-6">
 <ul>
 <li>Use at least 12 characters</li>
 <li>Mix uppercase and lowercase letters</li>
 <li>Include numbers and symbols</li>
 <li>Avoid dictionary words and personal info</li>
 </ul>
 </div>
 <div class="col-md-6">
 <ul>
 <li>Consider using passphrases</li>
 <li>Use unique passwords for each account</li>
 <li>Enable two-factor authentication</li>
 <li>Use a password manager</li>
 </ul>
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
 const passwordInput = document.getElementById('passwordInput');
 const togglePassword = document.getElementById('togglePassword');
 const eyeIcon = document.getElementById('eyeIcon');
 const form = document.getElementById('passwordAnalysisForm');

 // Toggle password visibility
 togglePassword.addEventListener('click', function() {
 const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
 passwordInput.setAttribute('type', type);
 eyeIcon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
 });

 // Handle form submission
 form.addEventListener('submit', function(event) {
 event.preventDefault();

 const formData = new FormData(form);
 const submitBtn = form.querySelector('button[type="submit"]');
 const originalText = submitBtn.innerHTML;

 // Show loading state
 submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
 submitBtn.disabled = true;

 fetch('{{ url_for('analyze_password') }}', {
 method: 'POST',
 body: formData
 })
 .then(response => response.json())
 .then(data => {
 if (data.error) {
 alert('Error: ' + data.error);
 } else {
 displayAnalysisResults(data.analysis, data.suggestions);
 showResults();
 }
 })
 .catch(error => {
 alert('Error: ' + error);
 })
 .finally(() => {
 submitBtn.innerHTML = originalText;
 submitBtn.disabled = false;
 });
 });
});

function showResults() {
 document.getElementById('strengthIndicator').style.display = 'block';
 document.getElementById('analysisResults').style.display = 'block';
}

function displayAnalysisResults(analysis, suggestions) {
 // Update strength indicator
 document.getElementById('strengthText').textContent = analysis.strength;
 const strengthBar = document.getElementById('strengthBar');
 strengthBar.style.width = analysis.score + '%';

 // Set colors based on strength
 const colorClass = analysis.strength_color === 'success' ? 'bg-success' :
 analysis.strength_color === 'info' ? 'bg-info' :
 analysis.strength_color === 'warning' ? 'bg-warning' : 'bg-danger';
 strengthBar.className = 'progress-bar ' + colorClass;

 // Update analysis results
 document.getElementById('scoreValue').textContent = analysis.score;
 document.getElementById('entropyValue').textContent = analysis.entropy + ' bits';
 document.getElementById('crackTime').textContent = analysis.estimated_crack_time;

 // Display details
 const detailsList = document.getElementById('detailsList');
 detailsList.innerHTML = '';

 const details = [
 { label: 'Length', value: analysis.details.length + ' characters', score: analysis.details.length_score },
 { label: 'Character Variety', value: analysis.details.character_variety.variety_count + '/4 types', score: analysis.details.variety_score },
 { label: 'Lowercase Letters', value: analysis.details.character_variety.lowercase ? 'Yes ✓' : 'No ✗' },
 { label: 'Uppercase Letters', value: analysis.details.character_variety.uppercase ? 'Yes ✓' : 'No ✗' },
 { label: 'Numbers', value: analysis.details.character_variety.digits ? 'Yes ✓' : 'No ✗' },
 { label: 'Special Characters', value: analysis.details.character_variety.special_chars ? 'Yes ✓' : 'No ✗' },
 { label: 'Common Password', value: analysis.details.is_common_password ? 'Yes ⚠️' : 'No ✓' }
 ];

 if (analysis.details.patterns_found && analysis.details.patterns_found.length > 0) {
 details.push({ label: 'Patterns Found', value: analysis.details.patterns_found.join(', ') });
 }

 details.forEach(detail => {
 const li = document.createElement('li');
 li.innerHTML = '<strong>' + detail.label + ':</strong> ' + detail.value;
 if (detail.score) {
 li.innerHTML += ' <small class="text-muted">(' + detail.score + ')</small>';
 }
 detailsList.appendChild(li);
 });

 // Display feedback
 const feedbackList = document.getElementById('feedbackList');
 feedbackList.innerHTML = '';
 analysis.feedback.forEach(feedback => {
 const li = document.createElement('li');
 li.innerHTML = '<i class="fas fa-info-circle text-info"></i> ' + feedback;
 feedbackList.appendChild(li);
 });

 // Display suggestions
 const suggestionsList = document.getElementById('suggestionsList');
 suggestionsList.innerHTML = '';
 suggestions.forEach(suggestion => {
 const li = document.createElement('li');
 li.innerHTML = '<i class="fas fa-lightbulb text-warning"></i> ' + suggestion;
 suggestionsList.appendChild(li);
 });
}
</script>
{% endblock %}