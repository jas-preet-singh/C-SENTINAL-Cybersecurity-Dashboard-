{% extends "base.html" %}

{% block title %}Admin Panel - CyberSec Dashboard{% endblock %}

{% block content %}
<div class="container">
 <div class="row mt-4">
 <div class="col-12">
 <div class="welcome-card">
 <h2>
 <i class="fas fa-cog"></i>
 Admin Panel
 </h2>
 <p>Monitor system activity and manage users.</p>
 </div>
 </div>
 </div>

 <!-- Statistics Cards -->
 <div class="row mb-4">
 <div class="col-lg-3 col-md-6 mb-3">
 <div class="card stat-card">
 <div class="card-body">
 <div class="stat-icon">
 <i class="fas fa-users"></i>
 </div>
 <div class="stat-details">
 <h4>{{ users|length }}</h4>
 <span>Total Users</span>
 </div>
 </div>
 </div>
 </div>

 <div class="col-lg-3 col-md-6 mb-3">
 <div class="card stat-card">
 <div class="card-body">
 <div class="stat-icon">
 <i class="fas fa-history"></i>
 </div>
 <div class="stat-details">
 <h4>{{ logs|length }}</h4>
 <span>Recent Activities</span>
 </div>
 </div>
 </div>
 </div>

 <div class="col-lg-3 col-md-6 mb-3">
 <div class="card stat-card">
 <div class="card-body">
 <div class="stat-icon">
 <i class="fas fa-shield-alt"></i>
 </div>
 <div class="stat-details">
 <h4>{{ users|selectattr('role', 'equalto', 'admin')|list|length }}</h4>
 <span>Administrators</span>
 </div>
 </div>
 </div>
 </div>

 <div class="col-lg-3 col-md-6 mb-3">
 <div class="card stat-card">
 <div class="card-body">
 <div class="stat-icon">
 <i class="fas fa-clock"></i>
 </div>
 <div class="stat-details">
 <h4>Live</h4>
 <span>System Status</span>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- User Management -->
 <div class="row mb-4">
 <div class="col-12">
 <div class="card module-card">
 <div class="card-header">
 <h5><i class="fas fa-users"></i> User Management</h5>
 </div>
 <div class="card-body">
 <div class="table-responsive">
 <table class="table table-dark table-striped">
 <thead>
 <tr>
 <th>User ID</th>
 <th>Name</th>
 <th>Email</th>
 <th>Role</th>
 <th>Joined</th>
 <th>Last Updated</th>
 </tr>
 </thead>
 <tbody>
 {% for user in users %}
 <tr>
 <td><code>{{ user.id }}</code></td>
 <td>
 {% if user.profile_image_url %}
 <img src="{{ user.profile_image_url }}" alt="Profile" class="profile-img-sm me-2">
 {% endif %}
 {{ user.first_name or 'N/A' }} {{ user.last_name or '' }}
 </td>
 <td>{{ user.email or 'N/A' }}</td>
 <td>
 <span class="badge bg-{{ 'danger' if user.role == 'admin' else 'primary' }}">
 {{ user.role.title() }}
 </span>
 </td>
 <td>{{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}</td>
 <td>{{ user.updated_at.strftime('%Y-%m-%d') if user.updated_at else 'N/A' }}</td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Activity Logs -->
 <div class="row">
 <div class="col-12">
 <div class="card module-card">
 <div class="card-header">
 <h5><i class="fas fa-history"></i> Activity Logs</h5>
 </div>
 <div class="card-body">
 <div class="table-responsive">
 <table class="table table-dark table-striped">
 <thead>
 <tr>
 <th>Timestamp</th>
 <th>User</th>
 <th>Action</th>
 <th>Details</th>
 <th>IP Address</th>
 </tr>
 </thead>
 <tbody>
 {% for log in logs %}
 <tr>
 <td>
 <small>{{ log.created_at.strftime('%Y-%m-%d %H:%M:%S') if log.created_at else 'N/A' }}</small>
 </td>
 <td>
 {% if log.user %}
 {{ log.user.first_name or 'User' }} {{ log.user.last_name or '' }}
 <br><small class="text-muted">{{ log.user.email or 'N/A' }}</small>
 {% else %}
 <span class="text-muted">Anonymous</span>
 {% endif %}
 </td>
 <td>
 <span class="badge bg-info">{{ log.action.replace('_', ' ').title() }}</span>
 </td>
 <td>
 <small>{{ log.details or 'N/A' }}</small>
 </td>
 <td>
 <code>{{ log.ip_address or 'N/A' }}</code>
 </td>
 </tr>
 {% endfor %}
 </tbody>
 </table>
 </div>
 </div>
 </div>
 </div>
 </div>
</div>
{% endblock %}
